# Install mask-rcnn-benchmark
# Edited version of https://github.com/facebookresearch/maskrcnn-benchmark/blob/master/INSTALL.md with the required dependenceis

cd external/mask-rcnn

pip install ninja==1.9.0.post1 yacs==0.1.7 cython==0.29.17 matplotlib==3.2.1 tqdm==4.45.0 opencv-python==4.2.0.34

pip install torchvision==0.5.0

export INSTALL_DIR=$PWD

# install pycocotools
cd $INSTALL_DIR
git clone https://github.com/cocodataset/cocoapi.git
cd cocoapi/PythonAPI
python setup.py build_ext install



# install cityscapesScripts
cd $INSTALL_DIR
git clone https://github.com/mcordts/cityscapesScripts.git
cd cityscapesScripts/
gedit setup.py
replace line 27 "with open("README.md") as f:" with "open("README.md", encoding='utf-8') as f:"
python setup.py build_ext install

# install apex
cd $INSTALL_DIR
git clone https://github.com/NVIDIA/apex.git
cd apex
python setup.py install --cuda_ext --cpp_ext

# install PyTorch Detection
cd $INSTALL_DIR
git clone https://github.com/facebookresearch/maskrcnn-benchmark.git
cd maskrcnn-benchmark
python setup.py build develop

unset INSTALL_DIR

# Install falkon
# Edited version of instructions in https://falkonml.github.io/falkon/install.html
cd ../..
git clone --recurse-submodules https://github.com/FalkonML/falkon.git
cd falkon
git checkout b0e45e5495a4e9801f9bf4608a92fb4a7f95d4df
pip install ./keops
pip install scipy==1.4.1
pip install .

# Datasets download
cd ../../Data/datasets/iCWT/TABLE-TOP
wget https://zenodo.org/record/3970624/files/table_top_annotations.tar.xz
tar -xvf table_top_annotations.tar.xz
rm table_top_annotations.tar.xz
mv table_top_annotations Annotations

wget https://zenodo.org/record/3970624/files/table_top_images.tar.xz
tar -xvf table_top_images.tar.xz
rm table_top_images.tar.xz
mv table_top_images Images

cd ../iCubWorld-Transformations
mkdir Images
cd Images
wget https://zenodo.org/record/835510/files/part1.tar.gz
tar -xvf part1.tar.gz --strip 1
wget https://zenodo.org/record/835510/files/part2.tar.gz
tar -xvf part2.tar.gz --strip 1
wget https://zenodo.org/record/835510/files/part3.tar.gz
tar -xvf part3.tar.gz --strip 1
wget https://zenodo.org/record/835510/files/part4.tar.gz
tar -xvf part4.tar.gz --strip 1

rm part1.tar.xz
rm part2.tar.xz
rm part3.tar.xz
rm part4.tar.xz

cd ..
mkdir Annotations
cd Annotations
wget https://zenodo.org/record/1227305/files/Annotations_refined.tar.gz
tar -xvf Annotations_refined.tar.gz --strip 1
rm Annotations_refined.tar.gz

cd ../..
mkdir iCubWorld-Transformations_manual
cd iCubWorld-Transformations_manual
ln -s ../iCubWorld-Transformations/Images .
mkdir Annotations
cd Annotations
wget https://zenodo.org/record/2563223/files/Annotations_manual.tar.gz
tar -xvf Annotations_manual.tar.gz --strip 1
rm Annotations_manual.tar.gz
